---
phase: 04-location-geofence
plan: 03
type: execute
wave: 2
depends_on: [04-01]
files_modified:
  - apps/web/src/app/admin/locations/page.tsx
  - apps/web/src/components/locations/LocationForm.tsx
  - apps/web/src/components/locations/LocationTable.tsx
  - apps/web/src/hooks/useLocations.ts
autonomous: true

must_haves:
  truths:
    - "Super Admin can view list of all office locations"
    - "Super Admin can add a new office location with name, address, coordinates, radius"
    - "Super Admin can edit existing office locations"
    - "Super Admin can deactivate office locations"
    - "Form validates coordinates and radius before submission"
  artifacts:
    - path: "apps/web/src/app/admin/locations/page.tsx"
      provides: "Admin location management page"
      min_lines: 50
    - path: "apps/web/src/hooks/useLocations.ts"
      provides: "React Query hooks for location API"
      exports: ["useLocations", "useCreateLocation", "useUpdateLocation", "useDeleteLocation"]
    - path: "apps/web/src/components/locations/LocationForm.tsx"
      provides: "Form for creating/editing locations"
      min_lines: 80
  key_links:
    - from: "apps/web/src/hooks/useLocations.ts"
      to: "/api/locations"
      via: "fetch in React Query"
      pattern: "fetch.*locations"
    - from: "apps/web/src/app/admin/locations/page.tsx"
      to: "apps/web/src/hooks/useLocations.ts"
      via: "hook import"
      pattern: "useLocations"
---

<objective>
Create Admin UI for Super Admin to manage office locations (geofence centers).

Purpose: Enable Super Admin to configure office locations for geofence verification (LOCN-01, LOCN-02).
Output: Admin page with location table, create/edit form, and delete functionality.
</objective>

<execution_context>
@/Users/adityaw/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adityaw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-location-geofence/04-RESEARCH.md
@apps/web/src/app/admin/projects/page.tsx
@apps/web/src/hooks/useTimesheets.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useLocations React Query hooks</name>
  <files>apps/web/src/hooks/useLocations.ts</files>
  <action>
Create React Query hooks for location API operations:

```typescript
import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';

interface OfficeLocation {
  id: string;
  name: string;
  address: string;
  latitude: number;
  longitude: number;
  radiusMeters: number;
  isActive: boolean;
  createdAt: string;
  updatedAt: string;
}

interface CreateLocationInput {
  name: string;
  address: string;
  latitude: number;
  longitude: number;
  radiusMeters: number;
}

interface UpdateLocationInput extends Partial<CreateLocationInput> {
  isActive?: boolean;
}
```

**useLocations()**: GET /locations, returns { data: OfficeLocation[], isLoading, error }
**useCreateLocation()**: POST /locations, invalidates 'locations' query on success
**useUpdateLocation()**: PATCH /locations/:id, invalidates 'locations' query on success
**useDeleteLocation()**: DELETE /locations/:id, invalidates 'locations' query on success

Use the existing API base URL pattern from other hooks. Include credentials: 'include' for auth cookies.
Handle errors with toast notifications using sonner.
  </action>
  <verify>TypeScript compiles: `npm run build --workspace=apps/web`</verify>
  <done>useLocations hooks exist and export correctly</done>
</task>

<task type="auto">
  <name>Task 2: Create LocationForm component</name>
  <files>apps/web/src/components/locations/LocationForm.tsx</files>
  <action>
Create a form component for creating/editing office locations:

Props:
- mode: 'create' | 'edit'
- initialData?: OfficeLocation (for edit mode)
- onSuccess: () => void
- onCancel: () => void

Form fields:
- name: Input (required)
- address: Textarea (required)
- latitude: NumberInput (required, -90 to 90)
- longitude: NumberInput (required, -180 to 180)
- radiusMeters: NumberInput (required, 50 to 5000, with unit label "meters")

Use react-hook-form with zod validation:
```typescript
const schema = z.object({
  name: z.string().min(2).max(100),
  address: z.string().min(5).max(500),
  latitude: z.number().min(-90).max(90),
  longitude: z.number().min(-180).max(180),
  radiusMeters: z.number().min(50).max(5000),
});
```

Use shadcn/ui components: Input, Textarea, Button, Label, Form.
Show loading state during submission.
Call useCreateLocation or useUpdateLocation based on mode.
Show success toast on completion, call onSuccess().
  </action>
  <verify>Component renders in isolation, form validation works</verify>
  <done>LocationForm handles create and edit modes with validation</done>
</task>

<task type="auto">
  <name>Task 3: Create Admin Locations page with table</name>
  <files>
    apps/web/src/app/admin/locations/page.tsx
    apps/web/src/components/locations/LocationTable.tsx
  </files>
  <action>
**LocationTable.tsx:**
Create a data table for displaying office locations:

Columns:
- Name
- Address (truncated with tooltip)
- Coordinates (formatted as "lat, lng")
- Radius (formatted with "m" suffix)
- Status (Active/Inactive badge)
- Actions (Edit, Delete buttons)

Use shadcn/ui Table component.
Implement row actions with dropdown menu (Edit, Delete).
Show confirmation dialog before delete.

**page.tsx:**
Create the admin locations page:

```tsx
'use client';

import { useState } from 'react';
import { useLocations, useDeleteLocation } from '@/hooks/useLocations';
import { LocationTable } from '@/components/locations/LocationTable';
import { LocationForm } from '@/components/locations/LocationForm';
import { Button } from '@/components/ui/button';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Plus } from 'lucide-react';
```

Features:
- Page title "Office Locations"
- "Add Location" button opens create dialog
- Table shows all locations from useLocations()
- Edit action opens edit dialog with pre-filled form
- Delete action shows confirmation, then calls useDeleteLocation
- Loading state while fetching
- Empty state when no locations

Protect page with role check (SuperAdmin only) or rely on API protection.
  </action>
  <verify>
1. `npm run build --workspace=apps/web` succeeds
2. Navigate to /admin/locations in browser
3. Page renders with table and add button
  </verify>
  <done>Admin locations page displays locations and supports CRUD operations</done>
</task>

</tasks>

<verification>
1. Web app builds: `npm run build --workspace=apps/web`
2. /admin/locations page loads for SuperAdmin
3. Can create new office location with form
4. Can edit existing location
5. Can delete (deactivate) location
6. Form validation prevents invalid coordinates/radius
7. Table shows all company locations
</verification>

<success_criteria>
- Admin locations page accessible at /admin/locations
- Location table displays all office locations
- Create form validates and submits
- Edit form pre-fills and updates
- Delete shows confirmation and deactivates
- React Query handles caching and invalidation
</success_criteria>

<output>
After completion, create `.planning/phases/04-location-geofence/04-03-SUMMARY.md`
</output>
