---
phase: 07-reports-dashboards
plan: 04
type: execute
wave: 3
depends_on: ["07-01", "07-02", "07-03"]
files_modified:
  - apps/web/src/app/dashboard/page.tsx
  - apps/web/src/hooks/index.ts
autonomous: false

must_haves:
  truths:
    - "Dashboard has quick link to reports for Manager/HR roles"
    - "Reports pages are accessible from main navigation"
    - "All phase requirements are met (REPT-01 through REPT-06)"
  artifacts:
    - path: "apps/web/src/app/dashboard/page.tsx"
      provides: "Reports navigation link for Manager/HR"
      contains: "/reports"
  key_links:
    - from: "apps/web/src/app/dashboard/page.tsx"
      to: "/reports"
      via: "router.push"
      pattern: "router\\.push.*reports"
---

<objective>
Add reports navigation to dashboard, export hooks, and verify all phase requirements are complete.

Purpose: Integration and final verification that all REPT requirements are met.
Output: Dashboard link to reports, complete phase verification.
</objective>

<execution_context>
@/Users/adityaw/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adityaw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-reports-dashboards/07-CONTEXT.md
@.planning/phases/07-reports-dashboards/07-01-SUMMARY.md
@.planning/phases/07-reports-dashboards/07-02-SUMMARY.md
@.planning/phases/07-reports-dashboards/07-03-SUMMARY.md

# Current dashboard
@apps/web/src/app/dashboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Reports Navigation to Dashboard</name>
  <files>
    apps/web/src/app/dashboard/page.tsx
    apps/web/src/hooks/index.ts
  </files>
  <action>
Add Reports link to dashboard page for Manager and HR roles, and export new hooks.

1. Update `apps/web/src/app/dashboard/page.tsx`:

Add to the imports:
```typescript
import { BarChart3 } from 'lucide-react';
```

Add a "Reports" button to the Admin Controls section (inside the isAdmin block, after existing buttons):
```typescript
<button onClick={() => router.push('/reports')} className="bg-white rounded-xl p-4 border border-silver-200 hover:border-blue-300 hover:shadow-md transition-all text-left group">
  <div className="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mb-3 group-hover:bg-indigo-200 transition-colors">
    <BarChart3 size={20} className="text-indigo-600" />
  </div>
  <p className="font-medium text-navy-900">Reports</p>
  <p className="text-sm text-silver-500">View dashboards</p>
</button>
```

Also add the Reports button to the Employee/Manager quick actions section for Manager role. Add after the existing Team button in the quick actions grid for the Employee dashboard:

```typescript
{user.role === 'Manager' && (
  <button onClick={() => router.push('/reports')} className="bg-white rounded-xl p-4 border border-silver-200 hover:border-blue-300 hover:shadow-md transition-all text-left group">
    <div className="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mb-3 group-hover:bg-indigo-200 transition-colors">
      <BarChart3 size={20} className="text-indigo-600" />
    </div>
    <p className="font-medium text-navy-900">Reports</p>
    <p className="text-sm text-silver-500">Team dashboard</p>
  </button>
)}
```

2. Update `apps/web/src/hooks/index.ts`:

Add export for useReports hooks:
```typescript
export { useManagerDashboard, useHRDashboard } from './useReports';
```

This ensures:
- Manager has access to Reports from dashboard
- HR/SuperAdmin has access to Reports from admin controls
- Hooks are properly exported for reuse
  </action>
  <verify>
- `grep -r "BarChart3" apps/web/src/app/dashboard/page.tsx` shows import
- `grep -r "/reports" apps/web/src/app/dashboard/page.tsx` shows navigation
- `grep -r "useReports" apps/web/src/hooks/index.ts` shows export
  </verify>
  <done>Dashboard updated with Reports navigation for Manager/HR/SuperAdmin roles, hooks exported</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Reports & Dashboards phase:
- ReportsService with Manager and HR dashboard endpoints
- Chart components (AttendanceBarChart, TimesheetPieChart)
- Widget components (MetricCard, NeedsAttentionSection, TeamStatusTable)
- PDF export functionality (A4 portrait, tables only)
- Manager Dashboard page (/reports/manager)
- HR Dashboard page (/reports/hr)
- Role-based routing
- Dashboard navigation links
  </what-built>
  <how-to-verify>
**Test as Manager:**
1. Login as a Manager user
2. From dashboard, click "Reports" button
3. Verify redirect to /reports/manager
4. Verify "Needs Attention" section shows at top if anomalies/late exist
5. Verify attendance chart shows weekly data
6. Verify team status table shows direct reports only
7. Click "Export Report" - verify PDF downloads with A4 portrait format, tables only

**Test as HR/SuperAdmin:**
1. Login as HR or SuperAdmin user
2. From dashboard (admin controls), click "Reports" button
3. Verify redirect to /reports/hr
4. Verify org-wide stats display
5. Verify anomaly breakdown shows by type and severity
6. Verify compliance metrics section shows avg check-in time, late percentage
7. Click "Export Report" - verify PDF downloads

**Test as Employee:**
1. Login as Employee user
2. Navigate to /reports directly
3. Verify redirect to /dashboard (employees don't have reports access)

**Verify Requirements:**
- REPT-01: Manager sees team attendance in TeamStatusTable
- REPT-02: Manager sees team hours in TimesheetPieChart
- REPT-03: HR sees company-wide stats in todayStats
- REPT-04: HR sees anomaly counts in anomalySummary
- REPT-05: PDF export works for both roles
- REPT-06: Different widgets per role (Manager vs HR dashboards)
  </how-to-verify>
  <resume-signal>Type "approved" to complete phase, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
**Requirements Checklist:**
- [ ] REPT-01: Manager team attendance dashboard - TeamStatusTable + todayStats
- [ ] REPT-02: Manager team timesheet summary - TimesheetPieChart + weeklyTimesheet
- [ ] REPT-03: HR org-wide attendance compliance - todayStats.attendanceRate
- [ ] REPT-04: HR anomaly overview - anomalySummary with byType/bySeverity
- [ ] REPT-05: Export to PDF - PdfExportButton + generators
- [ ] REPT-06: Role-based dashboard metrics - Manager vs HR different pages

**Success Criteria from Roadmap:**
1. Manager sees team check-in times and late arrivals - TeamStatusTable
2. Manager sees team hours per project - TimesheetPieChart
3. HR sees company-wide attendance stats - todayStats + weeklyAttendance chart
4. HR sees open anomalies count - anomalySummary.open
5. PDF export generates formatted report - A4 portrait with tables
6. Dashboard shows relevant widgets per role - Different pages with different data
</verification>

<success_criteria>
- All 6 REPT requirements implemented and verified
- Manager dashboard shows team-only data (security)
- HR dashboard shows org-wide data
- PDF exports work correctly
- Role-based routing enforced
- User approval received
</success_criteria>

<output>
After completion, create `.planning/phases/07-reports-dashboards/07-04-SUMMARY.md`
</output>
