---
phase: 08-mobile-app
plan: 03
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - apps/mobile/src/hooks/useTimesheets.ts
  - apps/mobile/src/hooks/useProjects.ts
  - apps/mobile/src/components/timesheets/TimesheetForm.tsx
  - apps/mobile/src/components/timesheets/TimesheetList.tsx
  - apps/mobile/app/(tabs)/timesheet.tsx
autonomous: true

must_haves:
  truths:
    - "User can create timesheet entries on mobile"
    - "User can select project and task"
    - "User can enter hours and notes"
    - "User can view timesheet history"
  artifacts:
    - path: "apps/mobile/src/hooks/useTimesheets.ts"
      provides: "Timesheet CRUD operations"
      exports: ["useTimesheets", "useCreateTimesheet"]
    - path: "apps/mobile/src/hooks/useProjects.ts"
      provides: "Projects and tasks data"
      exports: ["useProjects"]
    - path: "apps/mobile/src/components/timesheets/TimesheetForm.tsx"
      provides: "Entry form with project/task selection"
    - path: "apps/mobile/src/components/timesheets/TimesheetList.tsx"
      provides: "List of timesheet entries"
  key_links:
    - from: "apps/mobile/src/hooks/useTimesheets.ts"
      to: "apps/mobile/src/lib/api.ts"
      via: "API calls"
      pattern: "api\\.(get|post|patch|delete)"
    - from: "apps/mobile/src/components/timesheets/TimesheetForm.tsx"
      to: "apps/mobile/src/hooks/useProjects.ts"
      via: "project/task data"
      pattern: "useProjects"
---

<objective>
Implement mobile timesheet entry with project/task selection.

Purpose: Allow employees to log work hours against projects and tasks from their mobile device.
Output: Working timesheet flow with entry form, project/task selection, and history view.
</objective>

<execution_context>
@/Users/adityaw/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adityaw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-mobile-app/08-RESEARCH.md

# Web patterns to mirror
@apps/web/src/hooks/useTimesheets.ts

# Mobile foundation
@apps/mobile/src/lib/api.ts
@apps/mobile/src/theme/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useProjects and useTimesheets hooks</name>
  <files>
    apps/mobile/src/hooks/useProjects.ts
    apps/mobile/src/hooks/useTimesheets.ts
  </files>
  <action>
**1. Create `apps/mobile/src/hooks/useProjects.ts`:**

Hook for fetching projects and their tasks:

```typescript
interface Project {
  id: string;
  name: string;
  code: string;
  status: 'Active' | 'OnHold' | 'Completed' | 'Archived';
  tasks: Task[];
}

interface Task {
  id: string;
  name: string;
  code: string;
  status: 'Active' | 'OnHold' | 'Completed';
}

interface UseProjectsReturn {
  projects: Project[];
  isLoading: boolean;
  error: string | null;
  refresh: () => Promise<void>;
}
```

- Fetch from GET `/projects?include=tasks&status=Active`
- Filter to only Active projects with Active tasks
- Use `useState` and `useEffect` pattern

**2. Create `apps/mobile/src/hooks/useTimesheets.ts`:**

Hook for timesheet operations:

```typescript
interface TimesheetEntry {
  id: string;
  date: string;
  projectId: string;
  taskId?: string;
  hours: number;
  minutes: number;
  notes?: string;
  attachmentUrl?: string;
  project: { id: string; name: string; code: string };
  task?: { id: string; name: string; code: string };
  createdAt: string;
}

interface CreateTimesheetInput {
  date: string;
  projectId: string;
  taskId?: string;
  hours: number;
  minutes: number;
  notes?: string;
}

interface UseTimesheetsReturn {
  entries: TimesheetEntry[];
  todayTotal: { hours: number; minutes: number };
  isLoading: boolean;
  error: string | null;
  refresh: () => Promise<void>;
}

interface UseCreateTimesheetReturn {
  create: (input: CreateTimesheetInput) => Promise<boolean>;
  isCreating: boolean;
  error: string | null;
  clearError: () => void;
}
```

- `useTimesheets(date?: string)`: Fetches entries for date (default today)
  - GET `/timesheets?date={date}`
  - Calculates `todayTotal` from entries
- `useCreateTimesheet()`: Creates new entry
  - POST `/timesheets` with input
  - Returns success boolean
  - Handles validation errors (max 24h/day)

Export types and hooks.
  </action>
  <verify>
`cd apps/mobile && npm run typecheck` passes.
Both hooks export correctly with full type coverage.
  </verify>
  <done>
useProjects fetches active projects with tasks.
useTimesheets provides entry listing and creation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create timesheet UI components</name>
  <files>
    apps/mobile/src/components/timesheets/TimesheetForm.tsx
    apps/mobile/src/components/timesheets/TimesheetList.tsx
  </files>
  <action>
**1. Create `apps/mobile/src/components/timesheets/TimesheetForm.tsx`:**

Form for creating timesheet entries:

Props:
```typescript
interface TimesheetFormProps {
  projects: Project[];
  onSubmit: (input: CreateTimesheetInput) => Promise<void>;
  isSubmitting: boolean;
  initialDate?: string;
}
```

UI Structure:
- Date picker (default to today, format nicely)
- Project dropdown/picker
  - When project selected, show task dropdown
- Task dropdown (filtered by selected project)
- Hours/Minutes inputs (side by side)
  - Hours: 0-24 number input
  - Minutes: 0-59 number input
- Notes text input (multiline, optional)
- "Add Entry" button (disabled when submitting)

Use `@react-native-picker/picker` pattern or custom modal dropdown.
Actually, use react-native's built-in Picker or a simple TouchableOpacity with Modal for selection since we want to minimize new deps.

Validation:
- Project is required
- Hours + Minutes must be > 0
- Show error text under inputs if validation fails

Style using theme colors and typography.

**2. Create `apps/mobile/src/components/timesheets/TimesheetList.tsx`:**

List of timesheet entries:

Props:
```typescript
interface TimesheetListProps {
  entries: TimesheetEntry[];
  isLoading: boolean;
  onRefresh: () => Promise<void>;
}
```

UI Structure:
- FlatList with RefreshControl
- Empty state: "No entries for this date"
- Each item shows:
  - Project name (bold) + Task name (if exists)
  - Hours/minutes formatted (e.g., "2h 30m")
  - Notes preview (truncated)
  - Time created (relative: "2 hours ago" using date-fns)
- Cards with subtle shadow and border radius

Use theme from `../../theme`.
Format durations nicely: "2h 30m" not "2:30".
  </action>
  <verify>
`cd apps/mobile && npm run typecheck` passes.
Components exist with proper prop types.
  </verify>
  <done>
TimesheetForm allows project/task selection and time entry.
TimesheetList displays entries with project info.
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire timesheet tab page</name>
  <files>apps/mobile/app/(tabs)/timesheet.tsx</files>
  <action>
Update `apps/mobile/app/(tabs)/timesheet.tsx` to implement full timesheet functionality:

1. Import hooks:
   - `useTimesheets`, `useCreateTimesheet` from hooks
   - `useProjects` from hooks

2. Import components:
   - `TimesheetForm`, `TimesheetList`

3. State:
   - `selectedDate: string` (default to today in YYYY-MM-DD format)
   - `showForm: boolean` (toggle between form and list view)

4. Use hooks:
   - `const { projects, isLoading: projectsLoading } = useProjects()`
   - `const { entries, todayTotal, isLoading, refresh } = useTimesheets(selectedDate)`
   - `const { create, isCreating, error: createError } = useCreateTimesheet()`

5. Layout structure:
   ```
   Header: "Timesheets"

   Date selector row (< Today's Date >) - navigate between days

   Summary card:
     - "Today's Total: Xh Ym"
     - Remaining to 8h: "Remaining: Xh Ym"

   Tab/Toggle: "Entries" | "Add New"

   If "Entries": TimesheetList
   If "Add New": TimesheetForm
   ```

6. Form submission:
   - Call `create(input)`
   - On success: switch to "Entries" view, call `refresh()`
   - On error: show error in form

7. Date navigation:
   - Left/right arrows to change date
   - When date changes, entries refresh automatically (useEffect dependency)

8. Use Animated.View with FadeIn for smooth transitions.

Style consistently with dashboard using theme.
  </action>
  <verify>
`cd apps/mobile && npm run typecheck` passes.
Timesheet tab shows real data and allows entry creation.
  </verify>
  <done>
Timesheet page implemented with:
- Date navigation
- Entry creation form with project/task selection
- Entry history list
- Daily total summary
  </done>
</task>

</tasks>

<verification>
1. `cd apps/mobile && npm run typecheck` passes
2. Can navigate between dates
3. Can see entries for a date
4. Can create new entry with project/task
5. Total hours calculated correctly
</verification>

<success_criteria>
- User can create timesheet entries (MOBL-03)
- Project and task selection works
- Hours/minutes entry validated
- Entry history viewable with date navigation
- Daily total displayed
</success_criteria>

<output>
After completion, create `.planning/phases/08-mobile-app/08-03-SUMMARY.md`
</output>
