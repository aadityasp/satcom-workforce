---
phase: 03-timesheets-projects
plan: 03
type: execute
wave: 2
depends_on: [03-01]
files_modified:
  - apps/web/src/hooks/useTimesheets.ts
  - apps/web/src/components/timesheets/TimesheetEntryModal.tsx
  - apps/web/src/components/timesheets/TimesheetHistoryTable.tsx
  - apps/web/src/components/timesheets/WeeklySummary.tsx
  - apps/web/src/components/timesheets/TimePresetButtons.tsx
  - apps/web/src/components/timesheets/FileUpload.tsx
autonomous: true

must_haves:
  truths:
    - "User can open two-step modal to create timesheet entry"
    - "User can select project first, then optionally select task"
    - "User can use preset buttons for quick duration selection"
    - "User can upload file attachments"
    - "User can view timesheet history in table format"
    - "User can see weekly summary with daily totals"
  artifacts:
    - path: "apps/web/src/hooks/useTimesheets.ts"
      provides: "Timesheet CRUD operations and state"
      exports: ["useTimesheets"]
    - path: "apps/web/src/components/timesheets/TimesheetEntryModal.tsx"
      provides: "Two-step entry creation modal"
      contains: "step.*project"
    - path: "apps/web/src/components/timesheets/TimesheetHistoryTable.tsx"
      provides: "Timesheet history table view"
      contains: "table"
  key_links:
    - from: "apps/web/src/hooks/useTimesheets.ts"
      to: "/timesheets"
      via: "API fetch calls"
      pattern: "api\\.(get|post|patch|delete).*timesheets"
    - from: "apps/web/src/components/timesheets/TimesheetEntryModal.tsx"
      to: "apps/web/src/hooks/useTimesheets.ts"
      via: "Hook usage for CRUD"
      pattern: "useTimesheets"
---

<objective>
Build frontend components for timesheet entry creation and history viewing.

Purpose: Enable users to create timesheet entries via two-step modal and view/edit history.
Output: React hook + modal + table + summary components for full timesheet UI.
</objective>

<execution_context>
@/Users/adityaw/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adityaw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-timesheets-projects/03-CONTEXT.md
@.planning/phases/03-timesheets-projects/03-RESEARCH.md
@.planning/phases/03-timesheets-projects/03-01-SUMMARY.md

@apps/web/src/hooks/useAttendance.ts
@apps/web/src/components/attendance/CheckInModal.tsx
@apps/web/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useTimesheets hook</name>
  <files>apps/web/src/hooks/useTimesheets.ts</files>
  <action>
Create useTimesheets hook following useAttendance pattern:

```typescript
'use client';

import { useState, useEffect, useCallback } from 'react';
import { api } from '@/lib/api';

// Types
export interface Project {
  id: string;
  name: string;
  code: string;
  tasks: Task[];
}

export interface Task {
  id: string;
  name: string;
  code: string;
}

export interface TimesheetEntry {
  id: string;
  date: string;
  projectId: string;
  taskId?: string;
  minutes: number;
  notes?: string;
  project: Project;
  task?: Task;
  attachments: Attachment[];
  createdAt: string;
}

export interface Attachment {
  id: string;
  fileName: string;
  fileUrl: string;
  fileType: string;
}

export interface CreateTimesheetDto {
  date: string;
  projectId: string;
  taskId?: string;
  startTime: string;
  endTime: string;
  notes?: string;
  attachmentKeys?: string[];
}

export interface TimesheetSummary {
  totalMinutes: number;
  byProject: { projectId: string; projectName: string; minutes: number }[];
  byDate: { date: string; minutes: number }[];
}

interface UseTimesheetsReturn {
  // State
  entries: TimesheetEntry[];
  projects: Project[];
  summary: TimesheetSummary | null;
  isLoading: boolean;
  isActionLoading: boolean;
  error: string | null;

  // Actions
  fetchEntries: (startDate: string, endDate: string) => Promise<void>;
  fetchProjects: () => Promise<void>;
  fetchSummary: (startDate: string, endDate: string) => Promise<void>;
  createEntry: (data: CreateTimesheetDto) => Promise<boolean>;
  updateEntry: (id: string, data: Partial<CreateTimesheetDto>) => Promise<boolean>;
  deleteEntry: (id: string) => Promise<boolean>;
  getUploadUrl: (fileName: string, contentType: string) => Promise<{ uploadUrl: string; objectKey: string } | null>;
  clearError: () => void;
}

export function useTimesheets(): UseTimesheetsReturn {
  const [entries, setEntries] = useState<TimesheetEntry[]>([]);
  const [projects, setProjects] = useState<Project[]>([]);
  const [summary, setSummary] = useState<TimesheetSummary | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [isActionLoading, setIsActionLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const clearError = useCallback(() => setError(null), []);

  const fetchProjects = useCallback(async () => {
    try {
      const response = await api.get<Project[]>('/timesheets/projects');
      if (response.success && response.data) {
        setProjects(response.data);
      }
    } catch (err) {
      setError('Failed to load projects');
    }
  }, []);

  const fetchEntries = useCallback(async (startDate: string, endDate: string) => {
    setIsLoading(true);
    try {
      const response = await api.get<{ data: TimesheetEntry[] }>(
        `/timesheets?startDate=${startDate}&endDate=${endDate}`
      );
      if (response.success && response.data) {
        setEntries(response.data.data);
      }
    } catch (err) {
      setError('Failed to load entries');
    } finally {
      setIsLoading(false);
    }
  }, []);

  const fetchSummary = useCallback(async (startDate: string, endDate: string) => {
    try {
      const response = await api.get<TimesheetSummary>(
        `/timesheets/summary?startDate=${startDate}&endDate=${endDate}`
      );
      if (response.success && response.data) {
        setSummary(response.data);
      }
    } catch (err) {
      setError('Failed to load summary');
    }
  }, []);

  const createEntry = useCallback(async (data: CreateTimesheetDto): Promise<boolean> => {
    setIsActionLoading(true);
    setError(null);
    try {
      const response = await api.post('/timesheets', data);
      if (response.success) {
        // Refresh entries and summary after creation
        return true;
      } else {
        setError(response.error?.message || 'Failed to create entry');
        return false;
      }
    } catch (err) {
      setError('Network error');
      return false;
    } finally {
      setIsActionLoading(false);
    }
  }, []);

  const updateEntry = useCallback(async (id: string, data: Partial<CreateTimesheetDto>): Promise<boolean> => {
    setIsActionLoading(true);
    setError(null);
    try {
      const response = await api.patch(`/timesheets/${id}`, data);
      if (response.success) {
        return true;
      } else {
        setError(response.error?.message || 'Failed to update entry');
        return false;
      }
    } catch (err) {
      setError('Network error');
      return false;
    } finally {
      setIsActionLoading(false);
    }
  }, []);

  const deleteEntry = useCallback(async (id: string): Promise<boolean> => {
    setIsActionLoading(true);
    setError(null);
    try {
      const response = await api.delete(`/timesheets/${id}`);
      if (response.success) {
        return true;
      } else {
        setError(response.error?.message || 'Failed to delete entry');
        return false;
      }
    } catch (err) {
      setError('Network error');
      return false;
    } finally {
      setIsActionLoading(false);
    }
  }, []);

  const getUploadUrl = useCallback(async (fileName: string, contentType: string) => {
    try {
      const response = await api.get<{ uploadUrl: string; objectKey: string }>(
        `/storage/upload-url?folder=timesheets&fileName=${encodeURIComponent(fileName)}&contentType=${encodeURIComponent(contentType)}`
      );
      if (response.success && response.data) {
        return response.data;
      }
      return null;
    } catch (err) {
      setError('Failed to get upload URL');
      return null;
    }
  }, []);

  // Initial load of projects
  useEffect(() => {
    fetchProjects();
  }, [fetchProjects]);

  return {
    entries,
    projects,
    summary,
    isLoading,
    isActionLoading,
    error,
    fetchEntries,
    fetchProjects,
    fetchSummary,
    createEntry,
    updateEntry,
    deleteEntry,
    getUploadUrl,
    clearError,
  };
}
```
  </action>
  <verify>
Run `npm run build --workspace=apps/web` - no TypeScript errors
  </verify>
  <done>useTimesheets hook provides CRUD operations and state management for timesheets</done>
</task>

<task type="auto">
  <name>Task 2: Create timesheet entry modal (two-step)</name>
  <files>
    apps/web/src/components/timesheets/TimesheetEntryModal.tsx
    apps/web/src/components/timesheets/TimePresetButtons.tsx
    apps/web/src/components/timesheets/FileUpload.tsx
  </files>
  <action>
Create components directory and files:

**TimePresetButtons.tsx:**
```typescript
'use client';

interface TimePresetButtonsProps {
  onSelect: (minutes: number) => void;
  selectedMinutes?: number;
}

const presets = [
  { label: '30m', minutes: 30 },
  { label: '1h', minutes: 60 },
  { label: '2h', minutes: 120 },
  { label: '4h', minutes: 240 },
];

export function TimePresetButtons({ onSelect, selectedMinutes }: TimePresetButtonsProps) {
  return (
    <div className="flex gap-2">
      {presets.map((p) => (
        <button
          key={p.label}
          type="button"
          onClick={() => onSelect(p.minutes)}
          className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${
            selectedMinutes === p.minutes
              ? 'bg-blue-600 text-white'
              : 'bg-silver-100 text-silver-600 hover:bg-silver-200'
          }`}
        >
          {p.label}
        </button>
      ))}
    </div>
  );
}
```

**FileUpload.tsx:**
```typescript
'use client';

import { useCallback, useState } from 'react';
import { Upload, X, File, Loader2 } from 'lucide-react';

interface FileUploadProps {
  onFilesChange: (files: { file: File; objectKey?: string }[]) => void;
  files: { file: File; objectKey?: string }[];
  getUploadUrl: (fileName: string, contentType: string) => Promise<{ uploadUrl: string; objectKey: string } | null>;
}

export function FileUpload({ onFilesChange, files, getUploadUrl }: FileUploadProps) {
  const [uploading, setUploading] = useState<string | null>(null);

  const handleFileSelect = useCallback(async (e: React.ChangeEvent<HTMLInputElement>) => {
    const selectedFiles = Array.from(e.target.files || []);
    for (const file of selectedFiles) {
      setUploading(file.name);
      const urlData = await getUploadUrl(file.name, file.type);
      if (urlData) {
        // Upload to MinIO
        await fetch(urlData.uploadUrl, {
          method: 'PUT',
          body: file,
          headers: { 'Content-Type': file.type },
        });
        onFilesChange([...files, { file, objectKey: urlData.objectKey }]);
      }
      setUploading(null);
    }
    e.target.value = '';
  }, [files, getUploadUrl, onFilesChange]);

  const removeFile = useCallback((index: number) => {
    onFilesChange(files.filter((_, i) => i !== index));
  }, [files, onFilesChange]);

  return (
    <div className="space-y-2">
      <label className="flex items-center justify-center gap-2 p-4 border-2 border-dashed border-silver-300 rounded-lg cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-colors">
        {uploading ? (
          <>
            <Loader2 size={20} className="animate-spin text-blue-600" />
            <span className="text-sm text-silver-600">Uploading {uploading}...</span>
          </>
        ) : (
          <>
            <Upload size={20} className="text-silver-400" />
            <span className="text-sm text-silver-600">Click to upload files</span>
          </>
        )}
        <input
          type="file"
          multiple
          className="hidden"
          onChange={handleFileSelect}
          accept="image/*,.pdf,.doc,.docx,.xls,.xlsx"
          disabled={!!uploading}
        />
      </label>

      {files.length > 0 && (
        <div className="space-y-1">
          {files.map((f, i) => (
            <div key={i} className="flex items-center gap-2 p-2 bg-silver-50 rounded-lg">
              <File size={16} className="text-silver-500" />
              <span className="text-sm text-navy-900 flex-1 truncate">{f.file.name}</span>
              <button
                type="button"
                onClick={() => removeFile(i)}
                className="p-1 hover:bg-silver-200 rounded"
              >
                <X size={14} className="text-silver-500" />
              </button>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}
```

**TimesheetEntryModal.tsx:**
```typescript
'use client';

import { useState, useCallback, useMemo } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { X, ChevronLeft, FolderOpen, Loader2 } from 'lucide-react';
import type { Project, Task, CreateTimesheetDto, TimesheetEntry } from '@/hooks/useTimesheets';
import { TimePresetButtons } from './TimePresetButtons';
import { FileUpload } from './FileUpload';

type Step = 'project' | 'form';

interface TimesheetEntryModalProps {
  isOpen: boolean;
  isLoading: boolean;
  projects: Project[];
  editEntry?: TimesheetEntry;
  onClose: () => void;
  onSubmit: (data: CreateTimesheetDto) => Promise<boolean>;
  getUploadUrl: (fileName: string, contentType: string) => Promise<{ uploadUrl: string; objectKey: string } | null>;
}

export function TimesheetEntryModal({
  isOpen,
  isLoading,
  projects,
  editEntry,
  onClose,
  onSubmit,
  getUploadUrl,
}: TimesheetEntryModalProps) {
  const [step, setStep] = useState<Step>(editEntry ? 'form' : 'project');
  const [selectedProject, setSelectedProject] = useState<Project | null>(
    editEntry ? projects.find(p => p.id === editEntry.projectId) || null : null
  );
  const [selectedTask, setSelectedTask] = useState<Task | null>(
    editEntry?.task || null
  );
  const [startTime, setStartTime] = useState(editEntry ? '' : '09:00');
  const [endTime, setEndTime] = useState(editEntry ? '' : '17:00');
  const [notes, setNotes] = useState(editEntry?.notes || '');
  const [files, setFiles] = useState<{ file: File; objectKey?: string }[]>([]);

  const duration = useMemo(() => {
    if (!startTime || !endTime) return 0;
    const [sh, sm] = startTime.split(':').map(Number);
    const [eh, em] = endTime.split(':').map(Number);
    return (eh * 60 + em) - (sh * 60 + sm);
  }, [startTime, endTime]);

  const handleProjectSelect = useCallback((project: Project) => {
    setSelectedProject(project);
    setSelectedTask(null);
    setStep('form');
  }, []);

  const handlePresetSelect = useCallback((minutes: number) => {
    const [sh, sm] = startTime.split(':').map(Number);
    const totalMinutes = sh * 60 + sm + minutes;
    const eh = Math.floor(totalMinutes / 60);
    const em = totalMinutes % 60;
    setEndTime(`${String(eh).padStart(2, '0')}:${String(em).padStart(2, '0')}`);
  }, [startTime]);

  const handleSubmit = useCallback(async () => {
    if (!selectedProject || duration <= 0) return;

    const today = new Date().toISOString().split('T')[0];
    const data: CreateTimesheetDto = {
      date: today,
      projectId: selectedProject.id,
      taskId: selectedTask?.id,
      startTime: `${today}T${startTime}:00`,
      endTime: `${today}T${endTime}:00`,
      notes: notes || undefined,
      attachmentKeys: files.filter(f => f.objectKey).map(f => f.objectKey!),
    };

    const success = await onSubmit(data);
    if (success) {
      // Reset form
      setStep('project');
      setSelectedProject(null);
      setSelectedTask(null);
      setStartTime('09:00');
      setEndTime('17:00');
      setNotes('');
      setFiles([]);
      onClose();
    }
  }, [selectedProject, selectedTask, startTime, endTime, notes, files, duration, onSubmit, onClose]);

  const handleClose = useCallback(() => {
    setStep('project');
    setSelectedProject(null);
    setSelectedTask(null);
    setNotes('');
    setFiles([]);
    onClose();
  }, [onClose]);

  return (
    <AnimatePresence>
      {isOpen && (
        <>
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 bg-black/50 z-50"
            onClick={handleClose}
          />

          <motion.div
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            exit={{ opacity: 0, scale: 0.95 }}
            className="fixed inset-0 z-50 flex items-center justify-center p-4"
          >
            <div className="bg-white rounded-2xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-hidden flex flex-col" onClick={(e) => e.stopPropagation()}>
              {/* Header */}
              <div className="flex items-center justify-between p-4 border-b border-silver-100">
                {step === 'form' && (
                  <button onClick={() => setStep('project')} className="p-2 -ml-2 hover:bg-silver-50 rounded-lg">
                    <ChevronLeft size={20} />
                  </button>
                )}
                <h2 className="text-lg font-semibold text-navy-900 flex-1">
                  {step === 'project' ? 'Select Project' : 'Log Time'}
                </h2>
                <button onClick={handleClose} className="p-2 text-silver-500 hover:text-navy-900 transition-colors rounded-lg hover:bg-silver-50">
                  <X size={20} />
                </button>
              </div>

              {/* Content */}
              <div className="p-4 overflow-y-auto flex-1">
                {step === 'project' ? (
                  <div className="grid grid-cols-2 gap-3">
                    {projects.map((project) => (
                      <button
                        key={project.id}
                        onClick={() => handleProjectSelect(project)}
                        className="p-4 border border-silver-200 rounded-xl hover:border-blue-400 hover:bg-blue-50 transition-colors text-left"
                      >
                        <div className="flex items-center gap-2 mb-1">
                          <FolderOpen size={16} className="text-blue-500" />
                          <span className="text-xs text-silver-500">{project.code}</span>
                        </div>
                        <p className="font-medium text-navy-900">{project.name}</p>
                        <p className="text-xs text-silver-500 mt-1">{project.tasks.length} tasks</p>
                      </button>
                    ))}
                  </div>
                ) : (
                  <div className="space-y-4">
                    {/* Selected project display */}
                    <div className="p-3 bg-blue-50 rounded-lg">
                      <p className="text-sm text-blue-600 font-medium">{selectedProject?.name}</p>
                    </div>

                    {/* Task selection (optional) */}
                    {selectedProject && selectedProject.tasks.length > 0 && (
                      <div>
                        <label className="block text-sm font-medium text-navy-900 mb-2">Task (optional)</label>
                        <select
                          value={selectedTask?.id || ''}
                          onChange={(e) => setSelectedTask(selectedProject.tasks.find(t => t.id === e.target.value) || null)}
                          className="w-full px-3 py-2 border border-silver-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        >
                          <option value="">No task</option>
                          {selectedProject.tasks.map((task) => (
                            <option key={task.id} value={task.id}>{task.name} ({task.code})</option>
                          ))}
                        </select>
                      </div>
                    )}

                    {/* Time inputs */}
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-medium text-navy-900 mb-2">Start Time</label>
                        <input
                          type="time"
                          value={startTime}
                          onChange={(e) => setStartTime(e.target.value)}
                          className="w-full px-3 py-2 border border-silver-200 rounded-lg focus:ring-2 focus:ring-blue-500"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-navy-900 mb-2">End Time</label>
                        <input
                          type="time"
                          value={endTime}
                          onChange={(e) => setEndTime(e.target.value)}
                          className="w-full px-3 py-2 border border-silver-200 rounded-lg focus:ring-2 focus:ring-blue-500"
                        />
                      </div>
                    </div>

                    {/* Duration display */}
                    <div className="flex items-center justify-between">
                      <span className="text-sm text-silver-600">Duration: {Math.floor(duration / 60)}h {duration % 60}m</span>
                      <TimePresetButtons onSelect={handlePresetSelect} selectedMinutes={duration > 0 ? duration : undefined} />
                    </div>

                    {/* Notes */}
                    <div>
                      <label className="block text-sm font-medium text-navy-900 mb-2">Notes (optional)</label>
                      <textarea
                        value={notes}
                        onChange={(e) => setNotes(e.target.value)}
                        rows={3}
                        placeholder="What did you work on?"
                        className="w-full px-3 py-2 border border-silver-200 rounded-lg focus:ring-2 focus:ring-blue-500 resize-none"
                      />
                    </div>

                    {/* File upload */}
                    <div>
                      <label className="block text-sm font-medium text-navy-900 mb-2">Attachments (optional)</label>
                      <FileUpload files={files} onFilesChange={setFiles} getUploadUrl={getUploadUrl} />
                    </div>
                  </div>
                )}
              </div>

              {/* Footer */}
              {step === 'form' && (
                <div className="flex gap-3 p-4 border-t border-silver-100 bg-silver-50">
                  <button
                    onClick={handleClose}
                    className="flex-1 px-4 py-2.5 text-silver-600 bg-white border border-silver-200 rounded-lg hover:bg-silver-50 transition-colors font-medium"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={handleSubmit}
                    disabled={!selectedProject || duration <= 0 || isLoading}
                    className="flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                  >
                    {isLoading ? (
                      <>
                        <Loader2 size={18} className="animate-spin" />
                        Saving...
                      </>
                    ) : (
                      'Save Entry'
                    )}
                  </button>
                </div>
              )}
            </div>
          </motion.div>
        </>
      )}
    </AnimatePresence>
  );
}
```
  </action>
  <verify>
Run `npm run build --workspace=apps/web` - no TypeScript errors
  </verify>
  <done>
- Two-step modal: project selection → entry form
- Task dropdown optional
- Time inputs with preset buttons
- File upload with presigned URL flow
  </done>
</task>

<task type="auto">
  <name>Task 3: Create timesheet history table and weekly summary</name>
  <files>
    apps/web/src/components/timesheets/TimesheetHistoryTable.tsx
    apps/web/src/components/timesheets/WeeklySummary.tsx
  </files>
  <action>
**WeeklySummary.tsx:**
```typescript
'use client';

import type { TimesheetSummary } from '@/hooks/useTimesheets';

interface WeeklySummaryProps {
  summary: TimesheetSummary | null;
  isLoading: boolean;
}

export function WeeklySummary({ summary, isLoading }: WeeklySummaryProps) {
  if (isLoading || !summary) {
    return (
      <div className="bg-white rounded-xl border border-silver-200 p-4 animate-pulse">
        <div className="h-4 bg-silver-200 rounded w-24 mb-4" />
        <div className="grid grid-cols-7 gap-2">
          {[...Array(7)].map((_, i) => (
            <div key={i} className="h-16 bg-silver-100 rounded" />
          ))}
        </div>
      </div>
    );
  }

  const totalHours = Math.floor(summary.totalMinutes / 60);
  const totalMins = summary.totalMinutes % 60;

  // Create day map
  const dayMap = summary.byDate.reduce((acc, d) => {
    acc[d.date] = d.minutes;
    return acc;
  }, {} as Record<string, number>);

  // Get last 7 days
  const days = [...Array(7)].map((_, i) => {
    const date = new Date();
    date.setDate(date.getDate() - (6 - i));
    return date.toISOString().split('T')[0];
  });

  const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

  return (
    <div className="bg-white rounded-xl border border-silver-200 p-4">
      <div className="flex items-center justify-between mb-4">
        <h3 className="font-semibold text-navy-900">This Week</h3>
        <span className="text-2xl font-bold text-navy-900">
          {totalHours}h {totalMins}m
        </span>
      </div>

      <div className="grid grid-cols-7 gap-2">
        {days.map((date) => {
          const minutes = dayMap[date] || 0;
          const hours = Math.floor(minutes / 60);
          const dayOfWeek = new Date(date).getDay();
          const isToday = date === new Date().toISOString().split('T')[0];

          return (
            <div
              key={date}
              className={`flex flex-col items-center p-2 rounded-lg ${
                isToday ? 'bg-blue-50 border border-blue-200' : 'bg-silver-50'
              }`}
            >
              <span className="text-xs text-silver-500">{dayNames[dayOfWeek]}</span>
              <span className={`text-lg font-semibold ${minutes > 0 ? 'text-navy-900' : 'text-silver-400'}`}>
                {hours}h
              </span>
            </div>
          );
        })}
      </div>

      {/* Project breakdown */}
      {summary.byProject.length > 0 && (
        <div className="mt-4 pt-4 border-t border-silver-100">
          <h4 className="text-sm font-medium text-silver-600 mb-2">By Project</h4>
          <div className="space-y-1">
            {summary.byProject.map((p) => (
              <div key={p.projectId} className="flex items-center justify-between text-sm">
                <span className="text-navy-900">{p.projectName}</span>
                <span className="text-silver-600">{Math.floor(p.minutes / 60)}h {p.minutes % 60}m</span>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
}
```

**TimesheetHistoryTable.tsx:**
```typescript
'use client';

import { formatDistanceToNow } from 'date-fns';
import { Clock, Paperclip, MoreVertical, Edit2, Trash2 } from 'lucide-react';
import { useState } from 'react';
import type { TimesheetEntry } from '@/hooks/useTimesheets';

interface TimesheetHistoryTableProps {
  entries: TimesheetEntry[];
  isLoading: boolean;
  onEdit: (entry: TimesheetEntry) => void;
  onDelete: (id: string) => void;
}

export function TimesheetHistoryTable({ entries, isLoading, onEdit, onDelete }: TimesheetHistoryTableProps) {
  const [menuOpen, setMenuOpen] = useState<string | null>(null);

  const today = new Date().toISOString().split('T')[0];

  if (isLoading) {
    return (
      <div className="bg-white rounded-xl border border-silver-200 overflow-hidden">
        {[...Array(3)].map((_, i) => (
          <div key={i} className="p-4 border-b border-silver-100 animate-pulse">
            <div className="h-4 bg-silver-200 rounded w-1/3 mb-2" />
            <div className="h-3 bg-silver-100 rounded w-1/4" />
          </div>
        ))}
      </div>
    );
  }

  if (entries.length === 0) {
    return (
      <div className="bg-white rounded-xl border border-silver-200 p-8 text-center">
        <Clock size={32} className="mx-auto text-silver-300 mb-2" />
        <p className="text-silver-500">No timesheet entries yet</p>
      </div>
    );
  }

  return (
    <div className="bg-white rounded-xl border border-silver-200 overflow-hidden">
      <table className="w-full">
        <thead className="bg-silver-50">
          <tr>
            <th className="px-4 py-3 text-left text-xs font-medium text-silver-500 uppercase">Date</th>
            <th className="px-4 py-3 text-left text-xs font-medium text-silver-500 uppercase">Project</th>
            <th className="px-4 py-3 text-left text-xs font-medium text-silver-500 uppercase">Task</th>
            <th className="px-4 py-3 text-left text-xs font-medium text-silver-500 uppercase">Hours</th>
            <th className="px-4 py-3 text-left text-xs font-medium text-silver-500 uppercase">Notes</th>
            <th className="px-4 py-3 text-right text-xs font-medium text-silver-500 uppercase"></th>
          </tr>
        </thead>
        <tbody className="divide-y divide-silver-100">
          {entries.map((entry) => {
            const entryDate = entry.date.split('T')[0];
            const isEditable = entryDate === today;

            return (
              <tr key={entry.id} className="hover:bg-silver-50">
                <td className="px-4 py-3 text-sm text-navy-900">
                  {new Date(entry.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                </td>
                <td className="px-4 py-3">
                  <span className="text-sm font-medium text-navy-900">{entry.project.name}</span>
                  <span className="ml-2 text-xs text-silver-500">{entry.project.code}</span>
                </td>
                <td className="px-4 py-3 text-sm text-silver-600">
                  {entry.task?.name || '—'}
                </td>
                <td className="px-4 py-3 text-sm font-medium text-navy-900">
                  {Math.floor(entry.minutes / 60)}h {entry.minutes % 60}m
                </td>
                <td className="px-4 py-3 text-sm text-silver-600 max-w-xs truncate">
                  <div className="flex items-center gap-2">
                    {entry.notes || '—'}
                    {entry.attachments.length > 0 && (
                      <Paperclip size={14} className="text-silver-400" />
                    )}
                  </div>
                </td>
                <td className="px-4 py-3 text-right">
                  {isEditable && (
                    <div className="relative">
                      <button
                        onClick={() => setMenuOpen(menuOpen === entry.id ? null : entry.id)}
                        className="p-1 hover:bg-silver-100 rounded"
                      >
                        <MoreVertical size={16} className="text-silver-500" />
                      </button>
                      {menuOpen === entry.id && (
                        <div className="absolute right-0 mt-1 w-32 bg-white rounded-lg shadow-lg border border-silver-200 z-10">
                          <button
                            onClick={() => { onEdit(entry); setMenuOpen(null); }}
                            className="w-full px-3 py-2 text-left text-sm text-navy-900 hover:bg-silver-50 flex items-center gap-2"
                          >
                            <Edit2 size={14} /> Edit
                          </button>
                          <button
                            onClick={() => { onDelete(entry.id); setMenuOpen(null); }}
                            className="w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2"
                          >
                            <Trash2 size={14} /> Delete
                          </button>
                        </div>
                      )}
                    </div>
                  )}
                </td>
              </tr>
            );
          })}
        </tbody>
      </table>
    </div>
  );
}
```
  </action>
  <verify>
Run `npm run build --workspace=apps/web` - no TypeScript errors
  </verify>
  <done>
- WeeklySummary shows 7-day breakdown with project totals
- TimesheetHistoryTable displays entries with edit/delete for today only
- Click row menu to edit/delete (today's entries)
  </done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build --workspace=apps/web`
2. Component structure:
   - useTimesheets exports all CRUD operations
   - TimesheetEntryModal shows project grid → form flow
   - Table shows entries with correct formatting
   - Summary shows week breakdown
</verification>

<success_criteria>
- useTimesheets hook handles all API interactions
- Two-step modal flow: project → form
- Time presets work correctly
- File upload integrates with presigned URLs
- History table shows entries with edit/delete for today
- Weekly summary displays correctly
</success_criteria>

<output>
After completion, create `.planning/phases/03-timesheets-projects/03-03-SUMMARY.md`
</output>
