---
phase: 05-presence-activity
plan: 04
type: execute
wave: 3
depends_on: ["05-01", "05-03"]
files_modified:
  - apps/web/src/components/presence/SetActivityModal.tsx
  - apps/web/src/components/presence/ActivityStatusBar.tsx
  - apps/web/src/components/presence/TaskBreakdownCard.tsx
  - apps/web/src/components/presence/index.ts
  - apps/web/src/app/admin/team-activity/page.tsx
  - apps/web/src/app/dashboard/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can set current task/project from modal"
    - "User can post status update visible to team"
    - "Dashboard shows activity status bar with current task"
    - "Manager can view team's activities for any date"
    - "User can see task time breakdown for their work"
  artifacts:
    - path: "apps/web/src/components/presence/SetActivityModal.tsx"
      provides: "Modal for setting current project/task"
      exports: ["SetActivityModal"]
    - path: "apps/web/src/components/presence/ActivityStatusBar.tsx"
      provides: "Status bar showing current activity"
      exports: ["ActivityStatusBar"]
    - path: "apps/web/src/app/admin/team-activity/page.tsx"
      provides: "Manager team activity view"
      min_lines: 100
  key_links:
    - from: "apps/web/src/components/presence/SetActivityModal.tsx"
      to: "apps/web/src/hooks/usePresence.ts"
      via: "setActivity call"
      pattern: "setActivity\\("
    - from: "apps/web/src/app/admin/team-activity/page.tsx"
      to: "/api/presence/team-activity"
      via: "API call"
      pattern: "presence/team-activity"
---

<objective>
Build activity management UI including modal for setting current task, activity status bar for dashboard, manager team activity view, and task time breakdown.

Purpose: Complete ACTV-01 (set current task), ACTV-02 (post status), ACTV-03 (activity displays), ACTV-04 (task time breakdown), ACTV-05 (manager team view).

Output:
- SetActivityModal for selecting current project/task
- ActivityStatusBar for dashboard display
- TaskBreakdownCard for time breakdown view
- Manager team activity page
- Integration with dashboard
</objective>

<execution_context>
@/Users/adityaw/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adityaw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-presence-activity/05-RESEARCH.md
@.planning/phases/05-presence-activity/05-01-SUMMARY.md
@.planning/phases/05-presence-activity/05-03-SUMMARY.md

# Existing dashboard and patterns
@apps/web/src/app/dashboard/page.tsx
@apps/web/src/components/presence/index.ts
@apps/web/src/hooks/usePresence.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create activity management components</name>
  <files>
apps/web/src/components/presence/SetActivityModal.tsx
apps/web/src/components/presence/ActivityStatusBar.tsx
apps/web/src/components/presence/TaskBreakdownCard.tsx
apps/web/src/components/presence/index.ts
  </files>
  <action>
Create SetActivityModal (apps/web/src/components/presence/SetActivityModal.tsx):

```typescript
'use client';

import { useState, useEffect } from 'react';
import { X, Briefcase, CheckSquare, MessageSquare } from 'lucide-react';
import { usePresence } from '@/hooks/usePresence';
import { api } from '@/lib/api';

interface Project {
  id: string;
  name: string;
  code: string;
  tasks: Array<{ id: string; name: string; code: string }>;
}

interface SetActivityModalProps {
  isOpen: boolean;
  onClose: () => void;
}

export function SetActivityModal({ isOpen, onClose }: SetActivityModalProps) {
  const { setActivity, postStatus, clearStatus } = usePresence();
  const [projects, setProjects] = useState<Project[]>([]);
  const [selectedProject, setSelectedProject] = useState<string>('');
  const [selectedTask, setSelectedTask] = useState<string>('');
  const [statusMessage, setStatusMessage] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [activeTab, setActiveTab] = useState<'activity' | 'status'>('activity');

  // Fetch projects on mount
  useEffect(() => {
    if (isOpen) {
      fetchProjects();
    }
  }, [isOpen]);

  const fetchProjects = async () => {
    try {
      const response = await api.get<{ projects: Project[] }>('/projects');
      if (response.success && response.data) {
        setProjects(response.data.projects);
      }
    } catch (error) {
      console.error('Failed to fetch projects:', error);
    }
  };

  const handleSetActivity = async () => {
    if (!selectedProject) return;

    setIsLoading(true);
    try {
      setActivity(selectedProject, selectedTask || undefined);
      onClose();
    } finally {
      setIsLoading(false);
    }
  };

  const handlePostStatus = async () => {
    if (!statusMessage.trim()) return;

    setIsLoading(true);
    try {
      postStatus(statusMessage.trim());
      setStatusMessage('');
      onClose();
    } finally {
      setIsLoading(false);
    }
  };

  const handleClearStatus = () => {
    clearStatus();
    onClose();
  };

  const selectedProjectObj = projects.find((p) => p.id === selectedProject);

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center">
      {/* Backdrop */}
      <div
        className="absolute inset-0 bg-black/50"
        onClick={onClose}
      />

      {/* Modal */}
      <div className="relative bg-white rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-hidden">
        {/* Header */}
        <div className="flex items-center justify-between px-6 py-4 border-b border-silver-200">
          <h2 className="text-lg font-semibold text-navy-900">Update Status</h2>
          <button
            onClick={onClose}
            className="p-1 hover:bg-silver-100 rounded-lg"
          >
            <X size={20} className="text-silver-500" />
          </button>
        </div>

        {/* Tabs */}
        <div className="flex border-b border-silver-200">
          <button
            onClick={() => setActiveTab('activity')}
            className={`flex-1 px-4 py-3 text-sm font-medium flex items-center justify-center gap-2 ${
              activeTab === 'activity'
                ? 'text-blue-600 border-b-2 border-blue-600'
                : 'text-silver-500 hover:text-navy-900'
            }`}
          >
            <Briefcase size={16} />
            Current Activity
          </button>
          <button
            onClick={() => setActiveTab('status')}
            className={`flex-1 px-4 py-3 text-sm font-medium flex items-center justify-center gap-2 ${
              activeTab === 'status'
                ? 'text-blue-600 border-b-2 border-blue-600'
                : 'text-silver-500 hover:text-navy-900'
            }`}
          >
            <MessageSquare size={16} />
            Status Message
          </button>
        </div>

        {/* Content */}
        <div className="p-6 overflow-y-auto max-h-[60vh]">
          {activeTab === 'activity' ? (
            <div className="space-y-4">
              {/* Project select */}
              <div>
                <label className="block text-sm font-medium text-navy-900 mb-2">
                  <Briefcase size={14} className="inline mr-2" />
                  Project
                </label>
                <select
                  value={selectedProject}
                  onChange={(e) => {
                    setSelectedProject(e.target.value);
                    setSelectedTask('');
                  }}
                  className="w-full px-3 py-2 border border-silver-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                >
                  <option value="">Select a project...</option>
                  {projects.map((project) => (
                    <option key={project.id} value={project.id}>
                      {project.code} - {project.name}
                    </option>
                  ))}
                </select>
              </div>

              {/* Task select (if project selected) */}
              {selectedProjectObj && selectedProjectObj.tasks?.length > 0 && (
                <div>
                  <label className="block text-sm font-medium text-navy-900 mb-2">
                    <CheckSquare size={14} className="inline mr-2" />
                    Task (optional)
                  </label>
                  <select
                    value={selectedTask}
                    onChange={(e) => setSelectedTask(e.target.value)}
                    className="w-full px-3 py-2 border border-silver-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  >
                    <option value="">No specific task</option>
                    {selectedProjectObj.tasks.map((task) => (
                      <option key={task.id} value={task.id}>
                        {task.code} - {task.name}
                      </option>
                    ))}
                  </select>
                </div>
              )}

              <p className="text-xs text-silver-500">
                Your team will see what project you're currently working on.
              </p>
            </div>
          ) : (
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-navy-900 mb-2">
                  What are you working on?
                </label>
                <textarea
                  value={statusMessage}
                  onChange={(e) => setStatusMessage(e.target.value)}
                  placeholder="e.g., Reviewing quarterly reports..."
                  maxLength={200}
                  rows={3}
                  className="w-full px-3 py-2 border border-silver-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"
                />
                <p className="text-xs text-silver-400 mt-1 text-right">
                  {statusMessage.length}/200
                </p>
              </div>

              <button
                onClick={handleClearStatus}
                className="text-sm text-error hover:underline"
              >
                Clear current status
              </button>
            </div>
          )}
        </div>

        {/* Footer */}
        <div className="flex gap-3 px-6 py-4 border-t border-silver-200 bg-silver-50">
          <button
            onClick={onClose}
            className="flex-1 btn-secondary"
          >
            Cancel
          </button>
          <button
            onClick={activeTab === 'activity' ? handleSetActivity : handlePostStatus}
            disabled={
              isLoading ||
              (activeTab === 'activity' && !selectedProject) ||
              (activeTab === 'status' && !statusMessage.trim())
            }
            className="flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {isLoading ? 'Saving...' : 'Save'}
          </button>
        </div>
      </div>
    </div>
  );
}
```

Create ActivityStatusBar (apps/web/src/components/presence/ActivityStatusBar.tsx):

```typescript
'use client';

import { useState } from 'react';
import { Activity, Edit2, Clock, Briefcase, MessageSquare } from 'lucide-react';
import { usePresenceStore } from '@/store/presence';
import { useAuthStore } from '@/store/auth';
import { PresenceIndicator } from './PresenceIndicator';
import { SetActivityModal } from './SetActivityModal';
import { formatDistanceToNow } from 'date-fns';

export function ActivityStatusBar() {
  const [isModalOpen, setIsModalOpen] = useState(false);
  const { user } = useAuthStore();
  const { teamMembers, isConnected } = usePresenceStore();

  // Find current user's presence
  const myPresence = teamMembers.find((m) => m.userId === user?.id);

  return (
    <>
      <div className="bg-white rounded-xl border border-silver-200 p-4">
        <div className="flex items-center justify-between mb-3">
          <div className="flex items-center gap-2">
            <Activity size={18} className="text-navy-600" />
            <h3 className="font-medium text-navy-900">Your Status</h3>
          </div>
          <button
            onClick={() => setIsModalOpen(true)}
            className="p-1.5 hover:bg-silver-100 rounded-lg transition-colors"
            title="Update status"
          >
            <Edit2 size={16} className="text-silver-500" />
          </button>
        </div>

        {/* Connection status */}
        <div className="flex items-center gap-2 mb-3">
          <PresenceIndicator
            status={myPresence?.status || (isConnected ? 'Online' : 'Offline')}
            size="md"
            showLabel
          />
          {isConnected && (
            <span className="text-xs text-silver-400">• Real-time sync active</span>
          )}
        </div>

        {/* Current activity */}
        {myPresence?.currentProject ? (
          <div className="bg-blue-50 rounded-lg p-3 mb-3">
            <div className="flex items-center gap-2 text-sm">
              <Briefcase size={14} className="text-blue-600" />
              <span className="font-medium text-blue-900">
                {myPresence.currentProject.name}
              </span>
            </div>
            {myPresence.currentTask && (
              <p className="text-xs text-blue-700 mt-1 ml-5">
                Task: {myPresence.currentTask.name}
              </p>
            )}
          </div>
        ) : (
          <button
            onClick={() => setIsModalOpen(true)}
            className="w-full bg-silver-50 rounded-lg p-3 mb-3 border border-dashed border-silver-300 hover:border-silver-400 transition-colors"
          >
            <div className="flex items-center gap-2 text-sm text-silver-500">
              <Briefcase size={14} />
              <span>Set current activity...</span>
            </div>
          </button>
        )}

        {/* Status message */}
        {myPresence?.statusMessage ? (
          <div className="flex items-start gap-2 text-sm">
            <MessageSquare size={14} className="text-silver-400 mt-0.5" />
            <div>
              <p className="text-navy-900 italic">"{myPresence.statusMessage}"</p>
              {myPresence.statusUpdatedAt && (
                <p className="text-xs text-silver-400 mt-1">
                  <Clock size={10} className="inline mr-1" />
                  {formatDistanceToNow(new Date(myPresence.statusUpdatedAt), { addSuffix: true })}
                </p>
              )}
            </div>
          </div>
        ) : (
          <button
            onClick={() => setIsModalOpen(true)}
            className="flex items-center gap-2 text-sm text-silver-500 hover:text-navy-900 transition-colors"
          >
            <MessageSquare size={14} />
            <span>Add a status message...</span>
          </button>
        )}
      </div>

      <SetActivityModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} />
    </>
  );
}
```

Create TaskBreakdownCard (apps/web/src/components/presence/TaskBreakdownCard.tsx):

```typescript
'use client';

import { useState, useEffect } from 'react';
import { Clock, Briefcase, ChevronDown, ChevronUp } from 'lucide-react';
import { api } from '@/lib/api';
import { format, startOfWeek, endOfWeek, startOfDay, endOfDay } from 'date-fns';

interface TaskBreakdown {
  detailed: Array<{
    id: string;
    project: { id: string; name: string; code: string } | null;
    task: { id: string; name: string; code: string } | null;
    startedAt: string;
    endedAt: string | null;
    durationMinutes: number;
  }>;
  summary: Array<{
    project: { id: string; name: string; code: string };
    totalMinutes: number;
    tasks: Array<{ taskId: string; minutes: number }>;
  }>;
}

interface TaskBreakdownCardProps {
  period?: 'today' | 'week';
}

export function TaskBreakdownCard({ period = 'today' }: TaskBreakdownCardProps) {
  const [breakdown, setBreakdown] = useState<TaskBreakdown | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [isExpanded, setIsExpanded] = useState(false);

  useEffect(() => {
    fetchBreakdown();
  }, [period]);

  const fetchBreakdown = async () => {
    setIsLoading(true);
    try {
      const now = new Date();
      let startDate: Date;
      let endDate: Date;

      if (period === 'today') {
        startDate = startOfDay(now);
        endDate = endOfDay(now);
      } else {
        startDate = startOfWeek(now, { weekStartsOn: 1 }); // Monday
        endDate = endOfWeek(now, { weekStartsOn: 1 });
      }

      const response = await api.get<TaskBreakdown>(
        `/presence/task-breakdown?startDate=${startDate.toISOString()}&endDate=${endDate.toISOString()}`
      );

      if (response.success && response.data) {
        setBreakdown(response.data);
      }
    } catch (error) {
      console.error('Failed to fetch task breakdown:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const formatMinutes = (minutes: number): string => {
    if (minutes < 60) return `${minutes}m`;
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;
  };

  const totalMinutes = breakdown?.summary.reduce((sum, p) => sum + p.totalMinutes, 0) || 0;

  return (
    <div className="bg-white rounded-xl border border-silver-200 p-4">
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center gap-2">
          <Clock size={18} className="text-navy-600" />
          <h3 className="font-medium text-navy-900">
            {period === 'today' ? "Today's Activity" : 'This Week'}
          </h3>
        </div>
        <span className="text-sm font-semibold text-navy-900">
          {formatMinutes(totalMinutes)}
        </span>
      </div>

      {isLoading ? (
        <div className="flex items-center justify-center py-8">
          <Clock size={24} className="animate-spin text-silver-400" />
        </div>
      ) : !breakdown || breakdown.summary.length === 0 ? (
        <div className="text-center py-6 text-silver-500">
          <Briefcase size={32} className="mx-auto mb-2 text-silver-300" />
          <p className="text-sm">No activity tracked yet</p>
        </div>
      ) : (
        <div className="space-y-3">
          {breakdown.summary.map((project) => {
            const percentage = Math.round((project.totalMinutes / totalMinutes) * 100);

            return (
              <div key={project.project.id}>
                <div className="flex items-center justify-between text-sm mb-1">
                  <span className="text-navy-900 truncate">
                    {project.project.name}
                  </span>
                  <span className="text-silver-600 ml-2">
                    {formatMinutes(project.totalMinutes)} ({percentage}%)
                  </span>
                </div>
                <div className="h-2 bg-silver-100 rounded-full overflow-hidden">
                  <div
                    className="h-full bg-blue-500 rounded-full transition-all"
                    style={{ width: `${percentage}%` }}
                  />
                </div>
              </div>
            );
          })}

          {/* Expand/collapse for detailed view */}
          <button
            onClick={() => setIsExpanded(!isExpanded)}
            className="flex items-center gap-1 text-xs text-blue-600 hover:underline mt-2"
          >
            {isExpanded ? <ChevronUp size={14} /> : <ChevronDown size={14} />}
            {isExpanded ? 'Hide details' : 'Show details'}
          </button>

          {isExpanded && (
            <div className="mt-3 space-y-2 max-h-40 overflow-y-auto">
              {breakdown.detailed.map((entry) => (
                <div
                  key={entry.id}
                  className="flex items-center justify-between text-xs bg-silver-50 rounded px-2 py-1"
                >
                  <div className="truncate">
                    <span className="text-navy-900">
                      {entry.project?.name || 'Unknown'}
                    </span>
                    {entry.task && (
                      <span className="text-silver-500"> / {entry.task.name}</span>
                    )}
                  </div>
                  <span className="text-silver-600 ml-2 whitespace-nowrap">
                    {format(new Date(entry.startedAt), 'HH:mm')} -{' '}
                    {entry.endedAt
                      ? format(new Date(entry.endedAt), 'HH:mm')
                      : 'now'}
                  </span>
                </div>
              ))}
            </div>
          )}
        </div>
      )}
    </div>
  );
}
```

Update presence components index (apps/web/src/components/presence/index.ts):

```typescript
export * from './PresenceIndicator';
export * from './TeamListCard';
export * from './SetActivityModal';
export * from './ActivityStatusBar';
export * from './TaskBreakdownCard';
```
  </action>
  <verify>
Run `cd apps/web && npm run build` - should compile without errors.
Verify all new components are exported from index.ts.
  </verify>
  <done>
SetActivityModal allows selecting project/task and posting status.
ActivityStatusBar displays current activity and status message.
TaskBreakdownCard shows time spent per project with expandable details.
All components exported from presence index.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create manager team activity page</name>
  <files>apps/web/src/app/admin/team-activity/page.tsx</files>
  <action>
Create the manager team activity view (apps/web/src/app/admin/team-activity/page.tsx):

```typescript
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import {
  ArrowLeft,
  Users,
  Calendar,
  RefreshCw,
  ChevronLeft,
  ChevronRight,
  Briefcase,
  Clock,
} from 'lucide-react';
import { format, addDays, subDays, isToday } from 'date-fns';
import { api } from '@/lib/api';
import { PresenceIndicator } from '@/components/presence';

interface TeamActivity {
  userId: string;
  profile: {
    firstName: string;
    lastName: string;
    designation: string;
    department: string;
  } | null;
  presence: {
    status: 'Online' | 'Away' | 'Offline';
    statusMessage: string | null;
    currentProject: any;
    currentTask: any;
  } | null;
  activities: Array<{
    id: string;
    startedAt: string;
    endedAt: string | null;
    project: { id: string; name: string; code: string } | null;
    task: { id: string; name: string; code: string } | null;
  }>;
}

export default function TeamActivityPage() {
  const router = useRouter();
  const [date, setDate] = useState(new Date());
  const [activities, setActivities] = useState<TeamActivity[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    fetchTeamActivity();
  }, [date]);

  const fetchTeamActivity = async () => {
    setIsLoading(true);
    try {
      const response = await api.get<{ activities: TeamActivity[] }>(
        `/presence/team-activity?date=${format(date, 'yyyy-MM-dd')}`
      );

      if (response.success && response.data) {
        setActivities(response.data.activities);
      }
    } catch (error) {
      console.error('Failed to fetch team activity:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const goToPreviousDay = () => setDate(subDays(date, 1));
  const goToNextDay = () => setDate(addDays(date, 1));
  const goToToday = () => setDate(new Date());

  const formatDuration = (startedAt: string, endedAt: string | null): string => {
    const start = new Date(startedAt).getTime();
    const end = endedAt ? new Date(endedAt).getTime() : Date.now();
    const minutes = Math.round((end - start) / 60000);

    if (minutes < 60) return `${minutes}m`;
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;
  };

  return (
    <div className="min-h-screen bg-silver-50">
      {/* Header */}
      <header className="bg-white border-b border-silver-200 sticky top-0 z-50">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex items-center h-16 gap-4">
            <button
              onClick={() => router.back()}
              className="p-2 hover:bg-silver-100 rounded-lg"
            >
              <ArrowLeft size={20} />
            </button>
            <div className="flex items-center gap-2">
              <Users size={20} className="text-navy-600" />
              <h1 className="text-lg font-semibold text-navy-900">Team Activity</h1>
            </div>

            <div className="ml-auto flex items-center gap-2">
              <button
                onClick={fetchTeamActivity}
                disabled={isLoading}
                className="p-2 hover:bg-silver-100 rounded-lg disabled:opacity-50"
                title="Refresh"
              >
                <RefreshCw
                  size={16}
                  className={`text-silver-500 ${isLoading ? 'animate-spin' : ''}`}
                />
              </button>
            </div>
          </div>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        {/* Date navigation */}
        <div className="flex items-center justify-between mb-6">
          <div className="flex items-center gap-2">
            <button
              onClick={goToPreviousDay}
              className="p-2 hover:bg-silver-100 rounded-lg"
            >
              <ChevronLeft size={20} />
            </button>
            <div className="flex items-center gap-2 px-4 py-2 bg-white rounded-lg border border-silver-200">
              <Calendar size={16} className="text-silver-500" />
              <span className="font-medium text-navy-900">
                {format(date, 'EEEE, MMMM d, yyyy')}
              </span>
            </div>
            <button
              onClick={goToNextDay}
              disabled={isToday(date)}
              className="p-2 hover:bg-silver-100 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <ChevronRight size={20} />
            </button>
          </div>

          {!isToday(date) && (
            <button
              onClick={goToToday}
              className="text-sm text-blue-600 hover:underline"
            >
              Go to today
            </button>
          )}
        </div>

        {/* Team activity list */}
        {isLoading ? (
          <div className="flex items-center justify-center py-12">
            <RefreshCw size={24} className="animate-spin text-silver-400" />
          </div>
        ) : activities.length === 0 ? (
          <div className="text-center py-12 text-silver-500">
            <Users size={48} className="mx-auto mb-4 text-silver-300" />
            <p>No team members found</p>
          </div>
        ) : (
          <div className="space-y-4">
            {activities.map((member) => (
              <div
                key={member.userId}
                className="bg-white rounded-xl border border-silver-200 p-4"
              >
                {/* Member header */}
                <div className="flex items-start gap-4 mb-4">
                  <div className="relative">
                    <div className="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                      <span className="text-blue-600 font-medium">
                        {member.profile
                          ? `${member.profile.firstName[0]}${member.profile.lastName[0]}`
                          : '??'}
                      </span>
                    </div>
                    {member.presence && (
                      <div className="absolute -bottom-0.5 -right-0.5">
                        <PresenceIndicator status={member.presence.status} size="md" />
                      </div>
                    )}
                  </div>

                  <div className="flex-1">
                    <h3 className="font-medium text-navy-900">
                      {member.profile
                        ? `${member.profile.firstName} ${member.profile.lastName}`
                        : 'Unknown User'}
                    </h3>
                    <p className="text-sm text-silver-500">
                      {member.profile?.designation || 'Employee'}
                      {member.profile?.department && ` • ${member.profile.department}`}
                    </p>

                    {/* Current status message */}
                    {member.presence?.statusMessage && (
                      <p className="text-xs text-blue-600 mt-1 italic">
                        "{member.presence.statusMessage}"
                      </p>
                    )}
                  </div>

                  {/* Activity count */}
                  <div className="text-right">
                    <p className="text-sm text-silver-500">
                      {member.activities.length} activities
                    </p>
                  </div>
                </div>

                {/* Activity timeline */}
                {member.activities.length > 0 ? (
                  <div className="border-t border-silver-100 pt-3 space-y-2">
                    {member.activities.slice(0, 5).map((activity) => (
                      <div
                        key={activity.id}
                        className="flex items-center gap-3 text-sm"
                      >
                        <div className="w-16 text-xs text-silver-400">
                          {format(new Date(activity.startedAt), 'HH:mm')}
                        </div>
                        <div className="flex-1 flex items-center gap-2">
                          <Briefcase size={14} className="text-silver-400" />
                          <span className="text-navy-900">
                            {activity.project?.name || 'Unknown project'}
                          </span>
                          {activity.task && (
                            <span className="text-silver-500">
                              / {activity.task.name}
                            </span>
                          )}
                        </div>
                        <div className="flex items-center gap-1 text-xs text-silver-500">
                          <Clock size={12} />
                          {formatDuration(activity.startedAt, activity.endedAt)}
                          {!activity.endedAt && (
                            <span className="text-success"> (active)</span>
                          )}
                        </div>
                      </div>
                    ))}

                    {member.activities.length > 5 && (
                      <p className="text-xs text-silver-400 text-center pt-2">
                        + {member.activities.length - 5} more activities
                      </p>
                    )}
                  </div>
                ) : (
                  <div className="border-t border-silver-100 pt-3 text-center text-sm text-silver-500">
                    No activity tracked on this day
                  </div>
                )}
              </div>
            ))}
          </div>
        )}
      </main>
    </div>
  );
}
```
  </action>
  <verify>
Run `cd apps/web && npm run build` - should compile without errors.
Run `npm run dev` and visit http://localhost:3000/admin/team-activity as a Manager/HR/Admin user.
Verify date navigation works and team members are displayed.
  </verify>
  <done>
Team activity page shows all team members with their activities.
Date navigation allows viewing past days.
Each member shows status, current activity, and activity timeline.
Page is accessible to Manager, HR, and SuperAdmin roles.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate activity components into dashboard</name>
  <files>apps/web/src/app/dashboard/page.tsx</files>
  <action>
Update the dashboard to include ActivityStatusBar and TaskBreakdownCard.

Read the current dashboard file first to understand its structure, then add the presence components.

Add imports at the top:
```typescript
import { ActivityStatusBar, TaskBreakdownCard } from '@/components/presence';
```

Add the components to the dashboard layout. Find a suitable location in the existing grid/layout.

For employee dashboard section, add after other cards:
```tsx
{/* Activity Section */}
<div className="grid lg:grid-cols-2 gap-6 mt-6">
  <ActivityStatusBar />
  <TaskBreakdownCard period="today" />
</div>
```

If the dashboard has role-specific sections:
- For Employee: Show both ActivityStatusBar and TaskBreakdownCard
- For Manager/HR/Admin: Add a link to team activity page

Add a quick link to Team Activity for managers:
```tsx
{/* For Manager/HR/Admin roles */}
{(user?.role === 'Manager' || user?.role === 'HR' || user?.role === 'SuperAdmin') && (
  <Link
    href="/admin/team-activity"
    className="flex items-center gap-2 text-sm text-blue-600 hover:underline"
  >
    <Users size={14} />
    View Team Activity
  </Link>
)}
```

Note: The exact integration depends on the current dashboard structure. Follow the existing patterns and component organization.
  </action>
  <verify>
Run `cd apps/web && npm run build` - should compile without errors.
Run `npm run dev` and visit dashboard.
Verify ActivityStatusBar and TaskBreakdownCard appear on the dashboard.
Verify managers see link to Team Activity page.
  </verify>
  <done>
Dashboard includes ActivityStatusBar showing current activity/status.
Dashboard includes TaskBreakdownCard showing today's time breakdown.
Managers see link to Team Activity page.
Components integrated following existing dashboard patterns.
  </done>
</task>

</tasks>

<verification>
1. Frontend compiles: `cd apps/web && npm run build` succeeds
2. SetActivityModal works: Click edit button, select project/task, save - activity updates
3. Status message works: Post a status, see it displayed
4. TaskBreakdownCard shows data: Check dashboard for time breakdown
5. Team activity page: Visit /admin/team-activity as Manager, see team activities
6. Real-time updates: Change activity, see updates on team page without refresh
</verification>

<success_criteria>
1. SetActivityModal allows selecting project/task and shows in UI
2. StatusMessage can be posted and cleared
3. ActivityStatusBar shows on dashboard with current activity
4. TaskBreakdownCard shows time breakdown with expandable details
5. Team Activity page shows all team members with their activities
6. Date navigation works on team activity page
7. Components integrate smoothly with existing dashboard
8. Frontend compiles and runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-presence-activity/05-04-SUMMARY.md`
</output>
