---
phase: 02-attendance-core
plan: 04
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - apps/web/src/components/attendance/TimelineBar.tsx
  - apps/web/src/components/attendance/TimelineEventList.tsx
  - apps/web/src/app/attendance/page.tsx
autonomous: true

must_haves:
  truths:
    - "User sees horizontal bar showing work/break segments"
    - "User sees expandable vertical event list"
    - "Timeline shows all events: check-in, breaks, check-out"
    - "User can view any past date via date picker"
  artifacts:
    - path: "apps/web/src/components/attendance/TimelineBar.tsx"
      provides: "Horizontal bar visualization"
      min_lines: 50
    - path: "apps/web/src/components/attendance/TimelineEventList.tsx"
      provides: "Vertical event list"
      min_lines: 50
    - path: "apps/web/src/app/attendance/page.tsx"
      provides: "Dedicated attendance page"
      min_lines: 100
  key_links:
    - from: "TimelineBar.tsx"
      to: "attendance data"
      via: "events and breaks props"
      pattern: "events.*breaks"
---

<objective>
Build the timeline visualization components and dedicated attendance page.

Purpose: Per CONTEXT.md, user needs both horizontal bar summary (work/break segments) and expandable vertical event list with rich detail per event.

Output: Timeline components and /attendance page showing today's attendance with date picker for history.
</objective>

<execution_context>
@/Users/adityaw/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adityaw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-attendance-core/02-CONTEXT.md
@.planning/phases/02-attendance-core/02-RESEARCH.md
@apps/web/src/app/dashboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TimelineBar component</name>
  <files>apps/web/src/components/attendance/TimelineBar.tsx</files>
  <action>
Create `apps/web/src/components/attendance/TimelineBar.tsx`:

Props:
```typescript
interface TimelineBarProps {
  checkInTime: string | null;
  checkOutTime: string | null;
  events: AttendanceEvent[];
  breaks: BreakSegment[];
}
```

Implementation:
1. Build segments from check-in to check-out (or current time if not checked out)
2. Each segment is either 'work' or 'break' type
3. Use CSS flex-grow with duration ratios for segment widths
4. Colors per RESEARCH.md: blue for work, orange for break, purple for lunch
5. Tooltip on hover showing segment type and duration
6. Empty state if no check-in

Use `useMemo` to memoize segment calculation.

Segment building algorithm:
```typescript
function buildSegments(checkInTime, checkOutTime, breaks) {
  const segments = [];
  const sortedBreaks = [...breaks].sort((a, b) =>
    new Date(a.startTime).getTime() - new Date(b.startTime).getTime()
  );

  let currentTime = new Date(checkInTime);
  const endTime = checkOutTime ? new Date(checkOutTime) : new Date();

  for (const brk of sortedBreaks) {
    const breakStart = new Date(brk.startTime);
    const breakEnd = brk.endTime ? new Date(brk.endTime) : new Date();

    // Work segment before this break
    if (breakStart > currentTime) {
      segments.push({
        type: 'work',
        startTime: currentTime,
        endTime: breakStart,
        durationMinutes: differenceInMinutes(breakStart, currentTime),
      });
    }

    // Break segment
    segments.push({
      type: brk.type.toLowerCase(),
      startTime: breakStart,
      endTime: breakEnd,
      durationMinutes: differenceInMinutes(breakEnd, breakStart),
    });

    currentTime = breakEnd;
  }

  // Final work segment after last break
  if (currentTime < endTime) {
    segments.push({
      type: 'work',
      startTime: currentTime,
      endTime: endTime,
      durationMinutes: differenceInMinutes(endTime, currentTime),
    });
  }

  return segments;
}
```
  </action>
  <verify>
Run `npm run build --workspace=apps/web` - no TypeScript errors.
  </verify>
  <done>
TimelineBar renders segments with correct proportions and colors. Tooltips show details.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TimelineEventList component</name>
  <files>apps/web/src/components/attendance/TimelineEventList.tsx</files>
  <action>
Create `apps/web/src/components/attendance/TimelineEventList.tsx`:

Props:
```typescript
interface TimelineEventListProps {
  events: AttendanceEvent[];
  breaks: BreakSegment[];
  expanded?: boolean;
}
```

Implementation:
1. Combine events and breaks into chronological list
2. Each item shows:
   - Time (formatted with date-fns format)
   - Event type icon (LogIn, LogOut, Coffee icons)
   - Event type label
   - Duration (for breaks)
   - Work mode (for check-in)
   - Notes (if any)
   - Location indicator if coordinates present
3. Collapsible/expandable with framer-motion AnimatePresence
4. Empty state with message

Event item design:
```tsx
<div className="flex items-start gap-3 py-3 border-b border-silver-100">
  <div className={`p-2 rounded-lg ${iconBgClass}`}>
    <Icon size={18} className={iconColorClass} />
  </div>
  <div className="flex-1">
    <div className="flex justify-between">
      <span className="font-medium text-navy-900">{label}</span>
      <span className="text-sm text-silver-500">{formattedTime}</span>
    </div>
    {duration && <p className="text-sm text-silver-600">{duration}</p>}
    {notes && <p className="text-sm text-silver-500 mt-1">{notes}</p>}
  </div>
</div>
```
  </action>
  <verify>
Run `npm run build --workspace=apps/web` - no TypeScript errors.
  </verify>
  <done>
TimelineEventList renders all events chronologically with rich detail.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create dedicated attendance page</name>
  <files>apps/web/src/app/attendance/page.tsx</files>
  <action>
Create `apps/web/src/app/attendance/page.tsx`:

Layout:
1. Header with "Attendance" title and date picker
2. Date picker defaults to today, allows selecting past dates
3. AttendanceStatusCard (for today only - shows current state)
4. Timeline section:
   - TimelineBar (horizontal summary)
   - TimelineEventList (expandable detail)
5. Quick stats row: Total hours, Break time, Overtime

State management:
- Use useAttendance hook for today's data
- For past dates, fetch via api.get('/attendance', { startDate, endDate })
- Show loading skeleton while fetching

Date picker:
- Use a simple input type="date" or a custom date selector
- On date change, fetch that day's attendance
- Disable future dates

Empty state:
- "No attendance record for this date"
- If today: show check-in CTA

Integrate with dashboard navigation - add link from dashboard's quick actions.
  </action>
  <verify>
1. Run `npm run build --workspace=apps/web`
2. Navigate to /attendance - page renders without errors
3. Date picker works, past dates fetch correctly
  </verify>
  <done>
/attendance page shows timeline with both bar and event list. Date picker works for history.
  </done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build --workspace=apps/web`
2. Navigate to /attendance - see timeline components
3. TimelineBar shows proportional segments
4. TimelineEventList shows all events with details
5. Date picker loads past attendance
</verification>

<success_criteria>
- TimelineBar segments accurately reflect work/break periods
- TimelineEventList shows all event types with correct icons
- /attendance page accessible from dashboard
- Date picker allows viewing past dates
- Empty states handled gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/02-attendance-core/02-04-SUMMARY.md`
</output>
